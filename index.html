<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>æ£®æ£®å¤©æ°£ï½œå°å°è²¼å¿ƒæ°£è±¡åŠ©æ‰‹</title>
    <link rel="icon" type="image/png" href="./icon-v2.png" />
    <link rel="apple-touch-icon" href="./icon-v2.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        /* æº«æš–ç†æ€§çš„å¤§åœ°è‰²ï¼‹æŸ”å’Œè—ç¶  */
        --ac-green: #f7efe7;
        --ac-bg-pattern: #f1e3d3;
        --ac-cream: #fffaf3;
        --ac-yellow: #f6d365;
        --ac-brown: #6b4b3e;
        --ac-blue: #6ba8c8;
        --ac-dark: #4a433f;
        --ac-card-border: #eadfce;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: "Zen Maru Gothic", sans-serif;
        background-color: var(--ac-green);
        background-image: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 18px,
          rgba(255, 255, 255, 0.12) 18px,
          rgba(255, 255, 255, 0.12) 36px
        );
        min-height: 100vh;
        color: var(--ac-dark);
        overflow-x: hidden;
        padding-bottom: 20px;
      }

      /* é ‚éƒ¨ç‹€æ…‹åˆ— */
      .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 20px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.3)
        );
        backdrop-filter: blur(12px);
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom: 1px solid rgba(234, 223, 206, 0.9);
      }

      .location-pill {
        background: var(--ac-yellow);
        color: var(--ac-brown);
        padding: 6px 16px;
        border-radius: 999px;
        font-weight: 900;
        font-size: 1.05rem;
        transform: rotate(-1.5deg);
        border: 2px solid rgba(255, 255, 255, 0.9);
        box-shadow: 0 3px 0 rgba(189, 146, 96, 0.3);
        letter-spacing: 0.06em;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .update-pill {
        font-size: 0.78rem;
        color: var(--ac-dark);
        background: rgba(255, 255, 255, 0.8);
        padding: 5px 12px;
        border-radius: 999px;
        border: 1px solid rgba(209, 191, 165, 0.8);
        box-shadow: 0 2px 0 rgba(209, 191, 165, 0.7);
        white-space: nowrap;
      }

      .container {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
      }

      /* === æ ¸å¿ƒï¼šä»Šæ—¥ç„¦é»å¡ç‰‡ === */
      .hero-card {
        background: radial-gradient(
            circle at top left,
            rgba(255, 255, 255, 0.8),
            transparent 55%
          ),
          var(--ac-cream);
        border-radius: 30px;
        padding: 28px 22px 26px;
        text-align: center;
        box-shadow: 0 14px 28px rgba(79, 63, 47, 0.18);
        border: 1px solid var(--ac-card-border);
        margin-bottom: 26px;
        position: relative;
      }

      /* ä¸Šæ–¹æ™‚é–“æ®µæ¨™ç±¤ */
      .hero-period {
        position: absolute;
        top: -14px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, var(--ac-blue), #8bc0d9);
        color: #ffffff;
        padding: 6px 22px;
        border-radius: 999px;
        font-weight: 900;
        font-size: 0.92rem;
        border: 3px solid #ffffff;
        box-shadow: 0 5px 0 rgba(89, 125, 143, 0.5);
        letter-spacing: 0.12em;
      }

      .hero-temp-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        margin: 18px 0 10px;
      }

      .hero-icon {
        font-size: 4.6rem;
        filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.12));
        animation: bounce 3s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }

        50% {
          transform: translateY(-8px);
        }
      }

      .hero-temp {
        font-size: 4.2rem;
        font-weight: 900;
        color: var(--ac-brown);
        line-height: 1;
        letter-spacing: 0.04em;
      }

      .hero-desc {
        font-size: 1.15rem;
        color: #8a7b70;
        margin-bottom: 18px;
        font-weight: 700;
        line-height: 1.5;
      }

      /* === å¿«é€Ÿå»ºè­°å€ === */
      .advice-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
        margin-top: 18px;
        padding-top: 18px;
        border-top: 1px dashed rgba(212, 196, 172, 0.8);
      }

      .advice-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(255, 255, 255, 0.85);
        padding: 10px 10px 12px;
        border-radius: 20px;
        border: 1px solid rgba(234, 223, 206, 0.9);
        box-shadow: 0 3px 0 rgba(221, 202, 176, 0.6);
        transition: transform 0.15s ease, box-shadow 0.15s ease,
          background 0.15s ease;
      }

      .advice-item:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 12px rgba(79, 63, 47, 0.12);
        background: #fffdf8;
      }

      .advice-icon {
        font-size: 1.9rem;
        margin-bottom: 4px;
      }

      .advice-text {
        font-size: 1.05rem;
        font-weight: 900;
        color: var(--ac-brown);
        margin: 3px 0 2px;
        line-height: 1.3;
      }

      .advice-item small {
        font-size: 0.72rem;
        color: #9b8d81;
      }

      /* === ç¨å¾Œé å ±ï¼šæ©«å‘æ»‘å‹•å€ === */
      .section-title {
        font-size: 1.05rem;
        color: var(--ac-dark);
        margin-bottom: 12px;
        margin-left: 6px;
        font-weight: 900;
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.6);
        letter-spacing: 0.08em;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .section-title::before {
        content: "ğŸ”";
        font-size: 1rem;
      }

      .scroll-container {
        display: flex;
        overflow-x: auto;
        gap: 14px;
        padding-bottom: 8px;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .scroll-container::-webkit-scrollbar {
        display: none;
      }

      .mini-card {
        min-width: 130px;
        background: rgba(255, 250, 243, 0.95);
        border-radius: 22px;
        padding: 16px 12px 14px;
        text-align: center;
        border: 1px solid var(--ac-card-border);
        flex-shrink: 0;
        box-shadow: 0 4px 10px rgba(79, 63, 47, 0.12);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      .mini-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 7px 16px rgba(79, 63, 47, 0.18);
      }

      .mini-time {
        background: var(--ac-bg-pattern);
        color: var(--ac-dark);
        padding: 3px 9px;
        border-radius: 999px;
        font-size: 0.8rem;
        display: inline-block;
        margin-bottom: 8px;
        font-weight: 700;
        border: 1px solid rgba(219, 203, 179, 0.9);
      }

      .mini-icon {
        font-size: 2.3rem;
        margin: 4px 0;
      }

      .mini-temp {
        font-size: 1.02rem;
        font-weight: 800;
        color: var(--ac-dark);
      }

      .mini-extra {
        font-size: 0.8rem;
        color: #8f8276;
        margin-top: 6px;
      }

      /* Loading ç•«é¢ */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at top,
            rgba(255, 255, 255, 0.5),
            transparent 55%
          ),
          var(--ac-green);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }

      .loading-sub {
        color: var(--ac-brown);
        font-size: 0.88rem;
        margin-top: 6px;
        opacity: 0.9;
      }

      @media (max-width: 480px) {
        .hero-card {
          padding: 24px 18px 22px;
        }

        .hero-temp-container {
          gap: 10px;
        }

        .hero-temp {
          font-size: 3.8rem;
        }

        .hero-icon {
          font-size: 4rem;
        }

        .advice-grid {
          gap: 10px;
        }

        .advice-text {
          font-size: 0.98rem;
        }
      }
    </style>
  </head>

  <body>
    <div id="loading" class="loading-screen">
      <div style="font-size: 4rem; animation: bounce 2s infinite">â˜ï¸</div>
      <p
        style="
          color: var(--ac-brown);
          font-weight: bold;
          margin-top: 18px;
          font-size: 1rem;
        "
      >
        æ£®æ£®æ­£åœ¨å¹«ä½ è½å¤©ç©ºèªªè©±ä¸­â‹¯â‹¯
      </p>
      <p class="loading-sub">å°å°ç­‰ä¸€ä¸‹ä¸‹ï¼Œä»Šå¤©è¦æ€éº¼ç©¿æˆ‘å€‘ä¸€èµ·æƒ³ ğŸ˜Š</p>
    </div>

    <div class="status-bar">
      <div class="location-pill">ğŸ“ æ£®æ£®åŸºåœ°ãƒ»è‡ºå—å¸‚</div>
      <div id="updateTime" class="update-pill">å°å¤©æ°£æ•´ç†ä¸­â‹¯</div>
    </div>

    <div class="container" id="mainContent" style="display: none">
      <div id="heroCard"></div>

      <h3 class="section-title">ç¨å¾Œçš„æº«æŸ”æé†’</h3>
      <div class="scroll-container" id="futureForecasts"></div>
    </div>

    <script>
      const API_URL =
        "https://weather-taiwan-city.zeabur.app/api/weather/tainan";

      function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        return "ğŸŒ¤ï¸";
      }

      function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸŒ‚";
        let rainText = "ä»Šå¤©å¯ä»¥è¼•è£å‡ºé–€ï½";
        if (parseInt(rainProb) > 30) {
          rainIcon = "â˜”ï¸";
          rainText = "å£è¢‹æ”¾æŠŠå‚˜ï¼Œå¿ƒæƒ…æ›´å®‰å¿ƒ â˜”ï¸";
        }

        let clothIcon = "ğŸ‘•";
        let clothText = "èˆ’é©æ—¥å¸¸ç©¿æ­å°±å¥½";
        if (parseInt(maxTemp) >= 28) {
          clothIcon = "ğŸŒ";
          clothText = "æœ‰é»ç†±ç†±çš„ï½è¼•è–„çŸ­è¢–æœ€èˆ’æœ";
        } else if (parseInt(maxTemp) <= 20) {
          clothIcon = "ğŸ§¥";
          clothText = "æ°£æº«åæ¶¼ï¼Œè¨˜å¾—å¤šå¸¶ä¸€ä»¶å¤–å¥— ğŸ’›";
        }

        return { rainIcon, rainText, clothIcon, clothText };
      }

      function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();
        if (hour >= 5 && hour < 11) return "æ—©æ™¨æ™‚å…‰";
        if (hour >= 11 && hour < 14) return "ä¸­åˆå°æ†©";
        if (hour >= 14 && hour < 18) return "åˆå¾Œæ™‚æ®µ";
        if (hour >= 18 && hour < 23) return "æ™šä¸Šé™ªä½ ";
        return "æ·±å¤œéœéœ";
      }

      function renderWeather(data) {
        const forecasts = data.forecasts;
        const current = forecasts[0];
        const others = forecasts.slice(1);

        // 1. æ¸²æŸ“ Hero Card (ä¸»ç•«é¢)
        const advice = getAdvice(current.rain, current.maxTemp);
        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round(
          (parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2
        );

        document.getElementById("heroCard").innerHTML = `
          <div class="hero-card">
            <div class="hero-period">${period}</div>
            <div class="hero-temp-container">
              <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
              <div class="hero-temp">${avgTemp}Â°</div>
            </div>
            <div class="hero-desc">
              ä»Šå¤©æ˜¯<span style="font-weight:900;">${
                current.weather
              }</span>çš„ä¸€å¤©ï¼Œ<br />
              æ£®æ£®é™ªä½ ä¸€èµ·å¥½å¥½å‡ºé–€ã€å¥½å¥½å›å®¶ ğŸŒ¿
            </div>
            
            <div class="advice-grid">
              <div class="advice-item">
                <div class="advice-icon">${advice.rainIcon}</div>
                <div class="advice-text">${advice.rainText}</div>
                <small>é™é›¨æ©Ÿç‡ ${current.rain}</small>
              </div>
              <div class="advice-item">
                <div class="advice-icon">${advice.clothIcon}</div>
                <div class="advice-text">${advice.clothText}</div>
                <small>é ä¼°æœ€é«˜æº« ${current.maxTemp}Â°</small>
              </div>
            </div>
          </div>
        `;

        // 2. æ¸²æŸ“ç¨å¾Œé å ±
        const scrollContainer = document.getElementById("futureForecasts");
        scrollContainer.innerHTML = "";

        const todayDate = new Date().getDate();

        others.forEach((f) => {
          let p = getTimePeriod(f.startTime);

          const fDate = new Date(f.startTime);
          if (fDate.getDate() !== todayDate) {
            p = "æ˜å¤©ãƒ»" + p;
          }

          scrollContainer.innerHTML += `
            <div class="mini-card">
              <div class="mini-time">${p}</div>
              <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
              <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
              <div class="mini-extra">ğŸ’§ ${f.rain}ãƒ»å¹«ä½ å…ˆç•™æ„</div>
            </div>
          `;
        });

        // 3. å³ä¸Šè§’é¡¯ç¤ºä»Šæ—¥æ—¥æœŸ
        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayIndex = now.getDay();
        const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];

        document.getElementById(
          "updateTime"
        ).textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}ãƒ»å·²ç‚ºä½ æ•´ç†å¥½å›‰`;
      }

      async function fetchWeather() {
        try {
          const delayPromise = new Promise((resolve) =>
            setTimeout(resolve, 1500)
          );
          const fetchPromise = fetch(API_URL).then((res) => res.json());

          const [_, json] = await Promise.all([delayPromise, fetchPromise]);

          if (json.success) {
            renderWeather(json.data);

            document.getElementById("loading").style.display = "none";
            document.getElementById("mainContent").style.display = "block";
          } else {
            throw new Error("API Error");
          }
        } catch (e) {
          console.error(e);
          alert(
            "å¤©æ°£è³‡æ–™è®€å–å°å¤±èª¤ï¼Œæ£®æ£®æš«æ™‚é€£ä¸ä¸Šé›²æœµä¼ºæœå™¨ï¼Œç­‰ç­‰å†è©¦ä¸€æ¬¡å¥½å—ï¼ŸğŸŒ§ï¸"
          );
        }
      }

      document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
  </body>
</html>
